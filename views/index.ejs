<%- include('./components/header.ejs') %>
<%- include('./components/navbar.ejs') -%>
<section>
  <div class="container-fluid">
    <div class="row p-4 p-md-5 d-flex align-items-center">
      <div class="col-12 col-md-6">
        <h1>ENGLISH CLINIC FOR THAI LEARNERS</h1>
        <h4>English Online Self-Learning System</h4>
        <p>ระบบเรียนภาษาอังกฤษออนไลน์ที่ทันสมัยและมีประสิทธิภาพ<br> พร้อมให้คุณเรียนรู้ภาษาอังกฤษได้ทุกที่ทุกเวลา</p>
      </div>
      <div class="col-12 col-md-6">
        <img src="/assets/img/earth.webp" alt="" class="img-fluid">
      </div>
    </div>
  </div>
</section>

<!-- carousel -->
<section class="py-5">
  <div class="container-fluid">
    <div id="carouselExample" class="carousel slide" data-bs-ride="carousel">
      <div class="carousel-indicators" id="carouselIndicators"></div>
      <div class="carousel-inner" id="carouselContent">
        <template id="carouselTemplate">
          <div class="carousel-item">
            <div class="row p-4 p-md-5 slide-bg">
              <div class="col-12 col-md-8">
                <p class="rounded bg-info p-1 d-inline-block text-center mb-3">
                  บทความ <span class="slide-date text-light"></span>
                </p>
                <h1 class="slide-title text-light"></h1>
                <p class="slide-desc text-light"></p>
                <a class="slide-link btn btn-light">อ่านเพิ่มเติม</a>
              </div>

              <div class="col-12 col-md-4 d-flex slide-images mt-3 mt-md-0">
              </div>
            </div>
          </div>
        </template>
        <template id="imageTemplate">
          <div class="card me-1 flex-grow-1">
            <img class="img-fluid slide-img w-100">
          </div>
        </template>
      </div>

      <button class="carousel-control-prev" type="button" data-bs-target="#carouselExample" data-bs-slide="prev">
        <span class="carousel-control-prev-icon"></span>
      </button>
      <button class="carousel-control-next" type="button" data-bs-target="#carouselExample" data-bs-slide="next">
        <span class="carousel-control-next-icon"></span>
      </button>
    </div>
  </div>
</section>

<!-- content section -->
<section class="py-5">
  <div class="container-fluid">
    <div class="row align-items-center">
      <div class="col-12 col-md-6 d-flex flex-column align-self-center mb-4 mb-md-0">
        <h1>EOL PERSONAL</h1>
        <h1>SYSTEM PROGRAM</h1>
        <p>เรียนภาษาอังกฤษง่าย ๆ ด้วย EOL SYSTEM ระบบอัจฉริยะ ที่พัฒนามาอย่างต่อเนื่อง</p>
      </div>
      <div class="col-12 col-md-6">
        <img src="./assets/img/cards.webp" alt="" class="img-fluid rounded">
      </div>
    </div>
  </div>
</section>
<script>
  async function loadCarousel() {
    try {
      const res = await fetch("/api/example");
      if (!res.ok) throw new Error('Failed to fetch');
      const slides = await res.json();

      const indicators = document.getElementById("carouselIndicators");
      const content = document.getElementById("carouselContent");

      const tpl = document.getElementById("carouselTemplate");
      const imgTpl = document.getElementById("imageTemplate");

      slides.forEach((slide, index) => {
        // 1) indicators
        const btn = document.createElement("button");
        btn.setAttribute("type", "button");
        btn.setAttribute("data-bs-target", "#carouselExample");
        btn.setAttribute("data-bs-slide-to", index);
        if (index === 0) btn.classList.add("active");
        btn.setAttribute("aria-label", "Slide " + (index + 1));
        indicators.appendChild(btn);

        // 2) clone template
        const clone = tpl.content.cloneNode(true);

        const item = clone.querySelector(".carousel-item");
        if (index === 0) item.classList.add("active");

        // 3) ใส่ข้อมูลลง template
        clone.querySelector(".slide-title").textContent = slide.title;
        clone.querySelector(".slide-desc").textContent = slide.description;
        clone.querySelector(".slide-date").textContent = slide.date;
        const link = clone.querySelector(".slide-link");
        link.href = slide.link;
        link.setAttribute("aria-label", "Read more about " + slide.title);

        // set background image
        const slideBg = clone.querySelector(".slide-bg");
        if (slide.background) {
          slideBg.style.backgroundImage = `url('${slide.background}')`;
          slideBg.style.backgroundSize = "cover";
          slideBg.style.backgroundPosition = "center";
        }

        // 4) ใส่รูปหลายใบ
        const imgcontainer = clone.querySelector(".slide-images");

        if (slide.images && slide.images.length > 0) {
          slide.images.forEach(src => {
            const imgClone = imgTpl.content.cloneNode(true);
            const img = imgClone.querySelector(".slide-img");
            img.src = src;
            img.alt = slide.title + " image";
            imgcontainer.appendChild(imgClone);
          });
        }
        content.appendChild(clone);
      });

      if (slides.length > 1) {
        document.querySelector('.carousel-control-prev').style.display = 'block';
        document.querySelector('.carousel-control-next').style.display = 'block';
      }
    } catch (error) {
      console.error('Error loading carousel:', error);
      const content = document.getElementById("carouselContent");
      content.innerHTML = '<div class="carousel-item active"><div class="row p-5"><div class="col-12 text-center"><p>Unable to load carousel content</p></div></div></div>';
    }
  }
  document.addEventListener('DOMContentLoaded', loadCarousel);
</script>
<%- include('./components/footer.ejs') -%>
<%- include('./components/ender.ejs')  -%>