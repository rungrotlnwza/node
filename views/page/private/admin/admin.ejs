<div id="lesson_list" class="row row-cols-1 row-cols-md-2 g-4">
  <template id="lesson-template">
    <div class="col">
      <div class="card h-100 shadow-sm border-0 transition-hover">
        <div class="card-body">
          <div class="d-flex justify-content-between align-items-start mb-3">
            <span class="badge bg-light text-secondary border lesson-id"></span>
            <span class="lesson-status badge"></span>
          </div>

          <h5 class="card-title fw-bold text-dark mb-3 lesson-name"></h5>

          <div class="d-flex gap-2 mb-3">
            <span class="badge bg-primary-subtle text-primary border-primary-subtle lesson-category"></span>
            <span class="badge bg-warning-subtle text-warning-emphasis border-warning-subtle">
              Level: <span class="lesson-level"></span>
            </span>
          </div>

          <div class="text-muted mb-0" style="font-size: 0.7rem;">
            <div><i class="bi bi-calendar-plus me-1"></i> สร้าง: <span class="lesson-created-at"></span></div>
          </div>
        </div>

        <div class="card-footer bg-light border-top-0 d-flex gap-2 pb-3">
          <button class="btn btn-sm btn-outline-primary flex-fill btn-view">
            <i class="bi bi-eye"></i> ดู
          </button>
          <button class="btn btn-sm btn-outline-warning flex-fill btn-edit">
            <i class="bi bi-pencil"></i> แก้ไข
          </button>
          <button class="btn btn-sm btn-outline-danger flex-fill btn-delete">
            <i class="bi bi-trash"></i> ลบ
          </button>
        </div>
      </div>
    </div>
  </template>
</div>


<script>
  // --- 1. จัดการ URL เริ่มต้น ---
  const urlParams = new URLSearchParams(window.location.search);
  if (!urlParams.has('page')) {
    urlParams.set('page', '1');
    urlParams.set('limit', '10');
    const newUrl = window.location.pathname + '?' + urlParams.toString();
    window.history.replaceState(null, '', newUrl);
  }

  const page = urlParams.get('page') || 1;
  const limit = urlParams.get('limit') || 10;

  // --- 2. ดึงข้อมูลจาก API ---
  fetch(`/api/lessonAll?page=${page}&limit=${limit}`, {
      method: 'GET',
      headers: {
        'Content-Type': 'application/json',
        // ตรวจสอบฟังก์ชัน getCookie ของคุณด้วยนะครับ
        'Authorization': `Bearer ${typeof getCookie === 'function' ? getCookie('token') : ''}`
      }
    })
    .then(res => res.json())
    .then(data => {
      const container = document.getElementById('lesson_list');
      const template = document.getElementById('lesson-template');

      data.data.forEach(item => {
        const clone = template.content.cloneNode(true);

        // [ใส่ข้อมูล Text เหมือนเดิม...]
        clone.querySelector('.lesson-id').textContent = `ID: ${item.id}`;
        clone.querySelector('.lesson-name').textContent = item.lesson_name;
        // ... (ข้อมูลอื่นๆ)

        // --- เพิ่ม Logic สำหรับปุ่ม Action ---

        // 1. ปุ่มดู (View)
        clone.querySelector('.btn-view').onclick = () => {
          window.location.href = `/lesson/view/${item.id}`;
        };

        // 2. ปุ่มแก้ไข (Edit)
        clone.querySelector('.btn-edit').onclick = () => {
          window.location.href = `/lesson/edit/${item.id}`;
        };

        // 3. ปุ่มลบ (Delete) พร้อมระบบยืนยัน
        clone.querySelector('.btn-delete').onclick = () => {
          if (confirm(`คุณต้องการลบบทเรียน "${item.lesson_name}" ใช่หรือไม่?`)) {
            deleteLesson(item.id);
          }
        };

        container.appendChild(clone);
      });
    }).catch(err => console.error("Error loading lessons:", err));
</script>